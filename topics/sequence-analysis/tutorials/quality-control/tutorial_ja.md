---
layout: tutorial_hands_on
topic_name: sequence-analysis
tutorial_name: quality-control
---

# イントロダクション
{:.no_toc}

シークエンシング中に、曖昧なヌクレオチドの取り込みのような、エラーが導入される可能性があります。これは各シークエンシングプラットフォームの技術的な限界に起因しています。シークエンシングエラーは解析にバイアスをもたらし、最終的にはデータの誤解を招く可能性があります。 

したがってシークエンシングのクオリティチェックは生のシークエンスデータを受信した直後に行う不可欠なステップです。これはデータを取得するために使用されるシークエンシングプラットフォームに関係なく、適切な分析が確実に行われます。 

> ### Agenda
>
> このチュートリアルでは、以下のことを扱います:
>
> 1. TOC
> {:toc}
>
{: .agenda}

# シークエンスデータをインポートする 

> ### {% icon hands_on %} ハンズオン: データのアップロード 
>
> 1. ヒストリーを新規作成する 
> 2. 次の FASTQ ファイルをインポートする: [`GSM461178_untreat_paired_subset_1`](https://zenodo.org/record/61771/files/GSM461178_untreat_paired_subset_1.fastq)
>
>    > ### {% icon tip %} Tip: リンクからデータをインポートする 
>    >
>    > * リンクをコピーする 
>    > * Galaxy Upload Manager を開く
>    > * **Paste/Fetch Data** を選択する
>    > * テキストボックスにリンクをペーストする 
>    > * **Start** を押す    
>    {: .tip}
>
>    > ### {% icon tip %} Tip: データファイルがヒストリーにインポートされたらファイルタイプを `fastq` から `fastqsanger` に変更する 
>    >
>    > * ヒストリーのデータファイルに表示されている鉛筆ボタンをクリックする 
>    > * トップにある **Datatype** を選択する 
>    > * `fastqsanger` を選択する
>    > * **save** を押す
>    {: .tip}
>
>    > ### {% icon comment %} Comments
>    >
>    > データセットの名前を "First dataset" に変えましょう
>    {: .comment}
> デフォルトでは、リンクからデータをインポートすると、Galaxy での名前はその URL になります。
{: .hands_on}

# クオリティチェック 

配列のクオリティや生データをさらにフィルタリングする方法を推定するために、異なるインジケータをチェックすることができます:

- 配列のクオリティスコアについて
    - 塩基ごとの配列のクオリティ 
    - 配列ごとのクオリティスコア 
    - タイルごとの配列のクオリティ 
- 配列の含有量について 
    - 塩基ごとの配列の含有量 
    - 配列ごとの GC 含有量
    - 塩基ごとの N 含有量 
- 配列長の分布での配列長 
- 重複配列 
- タグ配列について 
    - アダプターのコンタミネーション 
    - K-mer の含有量 

[FastQC](https://www.bioinformatics.babraham.ac.uk/projects/fastqc/) はハイスループットシークエンシングパイプラインからの生配列データをクオリティコントロールする簡単な方法を提供するオープンソースのツールです。それは低いクオリティスコアのリードを取り除き、どのデータが解析のバイアスの原因となるかについての簡単な概要を提供するグラフィックスおよび推定を生成する。 

> ### {% icon hands_on %} ハンズオン: クオリティチェック 
>
> 1. **FastQC** {% icon tool %}: インポートした FastQ ファイルで、デフォルトの設定で **FastQC Read Quality reports** を実行する 
> 2. webpage のアウトプットで FastQC report を検査する 
>
>    > ### {% icon tip %} Tip: Galaxy でファイルの内容を検査する 
>    >
>    > * ヒストリーのファイル名の右にある目 ("データを表示する") をクリックする 
>    > * 中央でファイルの内容を検査する 
>    {: .tip}
>
>    > ### {% icon question %} Questions
>    >
>    > 1. クオリティスコアはどれくらいが良いですか？ 
>    > 2. なぜ塩基ごとの配列の含有量と配列ごとの GC 含有量のグラフが警告されているのですか？ 
>    > 3. シークエンスを改善するためには何が必要ですか？ 
>    >
>    >    <details>
>    >    <summary>クリックして回答を表示</summary>
>    >    <ol type="1">
>    >    <li>シークエンスのスコアは非常に良いです: たとえリードの末端でクオリティがわずかに低下しても、FastQC は警告しません</li>
>    >    <li>シークエンスの始めは、塩基ごとの配列の含有量は実際には良くなくパーセンテージは等しくありません。GC 含有量については、分布は左にわずかにシフトし、高すぎます。</li>
>    >    <li>配列の末端を少しだけトリミングすることができますが、配列がすでに小さいのであまり大きくはトリミングできません。</li>
>    >    </ol>
>    >    </details>
>    {: .question}
{: .hands_on}

# 配列のクオリティを改善する 

クオリティのグラフによって提供される情報に基づいて、下流の解析におけるバイアスを避けるために配列を処理しなければなりません。 

一般的に、クオリティの処理を行う場合は次の通りです:

- 配列のフィルタリングする 
    - 平均してクオリティスコアが低い 
    - 小さすぎる 
    - N 塩基が多すぎる
    - GC 含有量に基づいて 
    - ...
- 配列をカット/トリミングする
    - クオリティスコアが低い部分 
    - 末端 
    - ...

配列全体のクオリティを向上させるために、[Trim Galore!](https://www.bioinformatics.babraham.ac.uk/projects/trim_galore/) ツールを使用します。このツールはアダプターのトリミングとクオリティコントロールを自動化することにより配列のクオリティを向上させます。 

> ### {% icon hands_on %} ハンズオン: 配列のクオリティを改善する 
>
> 1. **Trim Galore!** {% icon tool %}: インポートした FastQ ファイルに対して **Trim Galore! Quality and adapter trimmer of reads** を実行する
>
>    > ### {% icon question %} Questions
>    >
>    > Which parameters must be applied to follow the previous recommendations?
>    >
>    > <details>
>    > <summary>クリックして回答を表示</summary>
>    > デフォルトのまま使用します:
>    > <ul>
>    > <li>​
ライブラリー作成中に使用されたアダプター配列が分かっている場合は、その配列を記入してください。それ以外の場合はアダプター配列の自動検出とトリミングのオプションを使用しましょう。</li>
>    > <li>アダプター配列の除去に加えてクオリティの低い末端（20未満）もトリミングしましょう</li>
>    > <li>アダプター配列との必要なオーバーラップ（bp）のオプションを微調整することができます。デフォルト値の "1" はかなり厳しく、平均して25%のリードがトリミングされます。必要なオーバーラップを緩めるためにも5塩基に設定してください</li>
>    > <li>20 bp より短いリードを除去しましょう</li>
>    > </ul>
>    > </details>
>    {: .question}
>
> 2. **FastQC** {% icon tool %}: クオリティコントロールを経たデータに対して **FastQC Read Quality reports** を再実行し、新しい FastQC レポートを検査する 
>
>    > ### {% icon question %} Questions
>    >
>    > 1. いくつの配列が除去されましたか？ 
>    > 2. 配列のクオリティは改善されましたか？ 
>    > 3. なぜ塩基ごとの配列の含有量が良くないのか説明できますか？ 
>    >
>    >    <details>
>    >    <summary>クリックして回答を表示</summary>
>    >    <ol type="1">
>    >    <li>Trim Galore の前は、データセットは100,000配列で構成されていました。Trim Galore 後は99,653配列になりました</li>
>    >    <li>塩基ごとのクオリティスコアは良く見えますが、他のインジケーターは悪いスコアを示しています。トリミング操作後の配列のサイズが異なるために配列長の分布はもはや明確ではないのです</li>
>    >    <li>塩基ごとの配列の含有量は赤色に変わっています。やはり、原因はいくつかの配列の末端のトリミングによるものです。</li>
>    >    </ol>
>    >    </details>
>    {: .question}
{: .hands_on}

以前のデータセットのクオリティは最初からかなり良好でした。配列のクオリティ処理は他のパラメーターを犠牲にしてクオリティスコアを改善したのです。 

# クオリティコントロールの影響について 

それでは、悪いデータセットでクオリティコントロールと処理の影響を見てみましょう。 

> ### {% icon hands_on %} ハンズオン: クオリティコントロールの影響 
>
> 1. ヒストリーを新規作成する 
> 2. 次の FASTQ ファイルをインポートする: [`GSM461182_untreat_single_subset`](https://zenodo.org/record/61771/files/GSM461182_untreat_single_subset.fastq)
> 3. **FastQC** {% icon tool %}: 新しくインポートされたデータセットで **FastQC Read Quality reports** を実行する
>
>    > ### {% icon question %} Questions
>    >
>    > 1. このデータセットはどれくらい良いですか？ 
>    > 2. 配列を改善するためには何が必要ですか？ 
>    >
>    >    <details>
>    >    <summary>クリックして回答を表示</summary>
>    >    <ol type="1">
>    >    <li>塩基ごとの配列のクオリティ（配列を通してかなり悪いが配列の末端が特に悪い）、塩基ごとの配列の含有量（配列の先頭が悪い）、そして配列ごとの GC 含有量に関して赤色の警告が出ています</li>
>    >    <li>配列の末端はカットしなければなりません。</li>
>    >    <li>一般に、シークエンスリードの5'末端は何かが間違っていなければクオリティは悪くなりません。ここで問題となるのは Illumina シークエンシング装置を使用してサンプルをシークエンスし、フローセルの先頭にあるフラグメントを読み取ってキャリブレーションを実行していることです。残念ながら、キャリブレーション中に生成された解析用に選択した100kのリードは、最近のシークエンシング装置では発生しない問題です。しかし、最新のシークエンシング装置を採用しても、リードの開始地点でクオリティの悪い塩基である場合は、それらをトリミングするだけではなく、他に問題があるかどうかを調査することを検討してください</li>
>    >    </ol>
>    >    </details>
>    {: .question}
>
> 4. **Trim Galore** {% icon tool %}: 新しいデータセットで **Trim Galore! Quality and adapter trimmer of reads** を実行して前のステップで行った決定を適用する
> 5. **FastQC** {% icon tool %}: **FastQC Read Quality reports** を再実行して Trim Galore の影響をチェックする
>
>    > ### {% icon question %} Questions
>    >
>    > 1. いくつの配列が除去されましたか？ 
>    > 2. 配列のクオリティは改善されましたか？ 
>    > 3. なぜ塩基ごとの配列の含有量が良くないのか説明できますか？ 
>    >
>    >    <details>
>    >    <summary>クリックして回答を表示</summary>
>    >    <ol type="1">
>    >    <li>Trim Galore の前はデータセットは100,000配列で構成されていました。Trim Galore の後は、97,644配列になりました</li>
>    >    <li>塩基ごとのクオリティスコアは良好に見えますが（赤色ではない）、塩基ごとの配列含有量は、わずかに良くなっていても、まだ赤色です</li>
>    >    </ol>
>    >    </details>
>    {: .question}
{: .hands_on}

# 結論
{:.no_toc}

このチュートリアルでは2つのデータセットのクオリティをチェックしてその他の情報を推測する前にデータが良いものになるようにしました。このステップは RNA-Seq や、 ChIP-Seq 、または NGS データに基づく他の OMIC 解析などのパイプライン解析のベースラインです。クオリティコントロールのステップはどのようなタイプのシークエンシングデータでも同様です:

![The quality control tutorial workflow](../../images/dive_into_qc_workflow.png)
